<% if (!title) { title = "Account Management" } %>

<%- include('../partials/header') %>
<%- nav %> <!-- Dynamic navigation from utilities.getNav() -->

<main>
  <h1><%= title %></h1>

  <!-- ✅ Flash Messages -->
  <% if (messages && typeof messages === 'object') { %>
    <div class="flash-messages">
      <% Object.keys(messages).forEach(function(type) { %>
        <% messages[type].forEach(function(msg) { %>
          <p class="<%= type %>"><%= msg %></p>
        <% }) %>
      <% }) %>
    </div>
  <% } %>

  <!-- ✅ Error Messages -->
  <% if (errors && errors.length > 0) { %>
    <div class="error-messages">
      <% errors.forEach(function(error) { %>
        <p><%= error.msg %></p>
      <% }) %>
    </div>
  <% } %>

  <!-- ✅ Personalized Greeting -->
  <% if (accountData && accountData.account_firstname) { %>
    <h2>Welcome <%= accountData.account_firstname %></h2>
    <p>You're logged in.</p>
  <% } else { %>
    <p>Please <a href="/account/login">log in</a> to manage your account.</p>
  <% } %>

  <% if (accountData) { %>
    <div class="management-container">
      <h2>Account Tools</h2>
      <p>Manage your account settings and vehicle inventory (if applicable).</p>

      <!-- ✅ Update Account Info Link -->
      <% if (accountData.account_id) { %>
        <a href="/account/edit/<%= accountData.account_id %>" class="btn btn-secondary">Update Account Info</a>
        <a href="/account/change-password/<%= accountData.account_id %>" class="btn btn-outline-secondary">Change Password</a>
        <a href="/account/logout" class="btn btn-danger">Log Out</a>
      <% } else { %>
        <p class="warning">Account ID missing. Please contact support.</p>
      <% } %>
    </div>

    <!-- ✅ Inventory Management Section (for Employee/Admin only) -->
    <% if (accountData.account_type === 'Employee' || accountData.account_type === 'Admin') { %>
      <section class="inventory-management">
        <h2>Inventory Management</h2>
        <p>Use the tools below to manage vehicle inventory.</p>

        <div class="management-links">
          <a href="/inv/add-classification" class="btn btn-primary">Add New Classification</a>
          <a href="/inv/add-inventory" class="btn btn-primary">Add New Vehicle</a>
        </div>

        <% if (typeof classificationSelect !== 'undefined') { %>
          <div id="classificationList">
            <%- classificationSelect %>
          </div>

          <table id="inventoryDisplay"></table>
          <noscript>JavaScript must be enabled to use this page.</noscript>
        <% } %>
      </section>
    <% } %>
  <% } %>
</main>

<%- include('../partials/footer') %>
<script src="/js/inventory.js"></script> <!-- ✅ JS hook for inventory table -->